---
title: "Case Study: Fix на счупени SEO URL-и с „л“ в OpenCart 2.3.0.2"
publishedAt: "2025-08-26"
summary: "Fix на счупени SEO URL-и в OpenCart 2.3.0.2: буквата „л“ се записваше като „?“ и водеше до 404 грешки – решено с OCMOD и SQL, без плъгини."
team:
  - name: "Станчев"
    role: "OpenCart & E-commerce Specialist"
    avatar: "/images/avatar.jpg"
    linkedIn: "https://www.linkedin.com/in/stantcheff"
---

<section>
  <h2>Накратко за проекта</h2>

  <p>
    В онлайн магазин на OpenCart 2.3.0.2, който продава хранителни добавки, клиентът се сблъска със странен бъг: всеки път когато в SEO URL се използваше буквата <strong>„л“</strong>, линкът се чупеше. Например <code>/масло</code> се записваше като <code>/мас?о</code> и водеше до <strong>404 грешка</strong>. 
  </p>

  <p>
    Това е все едно на табелата пред магазина да пише „МАС?О“ вместо „МАСЛО“ – никой клиент не е сигурен дали е на правилното място. За SEO това е катастрофа, защото търсачките виждат счупени адреси, а за потребителите – лошо изживяване.
  </p>

  <h3>Ключови подобрения</h3>

  <ul>
    <li>
      <strong>Поправяне на кода на OpenCart</strong>, така че нови URL-и с „л“ да се записват правилно и да не се чупят.
    </li>
    <li>
      <strong>SQL автоматизация</strong> за поправяне на вече счупените SEO ключове в базата данни.
    </li>
    <li>
      <strong>Подобряване на UX и SEO</strong>, като се премахват грешните 404 и URL-ите стават разбираеми и работещи.
    </li>
  </ul>

  <h3>Използвани технологии</h3>

  <ul>
    <li><strong>OpenCart 2.3.0.2</strong> – платформата, в която се появи проблемът.</li>
    <li><strong>OCMOD</strong> – за корекция на библиотеката <code>utf8.php</code>, без да се пипа ядрото на OpenCart.</li>
    <li><strong>MySQL</strong> – за директна подмяна на грешно записаните символи в таблицата <code>oc_url_alias</code>.</li>
  </ul>

  <h3>Предизвикателства</h3>

  <p>
    Проблемът се криеше в това, че OpenCart използваше <code>strtolower()</code> вместо <code>mb_strtolower()</code> за работа с UTF-8 символи. Буквата „л“ не се разпознаваше и се записваше като „?“. В резултат новите продукти и категории със „л“ в SEO keyword автоматично ставаха недостъпни.
  </p>

  <p>
    Това е все едно да напишеш адрес на кирилица и пощальонът да не разпознава буквата „л“ – писмото никога няма да стигне до получателя.
  </p>

  <h3>Решение с OCMOD</h3>

  <p>
    Създадох OCMOD файл, който замества дефиницията на <code>utf8_strtolower</code> в <code>system/library/utf8.php</code>, така че винаги да използва <code>mb_strtolower</code> при работа с кирилица:
  </p>
</section>

```xml
<?xml version="1.0" encoding="utf-8"?>
<modification>
  <name>Fix UTF-8 strtolower for Cyrillic</name>
  <code>fix_utf8_strtolower</code>
  <version>1.0</version>
  <author>Станчев</author>
  <link>http://your-site.com</link>

  <file path="system/library/utf8.php">
    <operation>
      <search><![CDATA[function utf8_strtolower($str) {]]></search>
      <add position="replace"><![CDATA[
function utf8_strtolower($str) {
    if (function_exists('mb_strtolower')) {
        return mb_strtolower($str, 'UTF-8');
    }
    return strtolower($str);
}]]></add>
    </operation>
  </file>
</modification>
<section> 
<p> След качване през админ панела (Extensions → Modifications → Upload) и натискане на Refresh, всички нови SEO URL-и с „л“ започнаха да се записват правилно. </p> 
<h3>SQL заявка за поправяне на старите</h3> 
<p> Старите записи обаче вече бяха счупени (<code>мас?о</code> вместо <code>масло</code>). За да ги поправя наведнъж, използвах SQL заявка: </p> 
</section>
```sql
UPDATE oc_url_alias
SET keyword = REPLACE(keyword, '?', 'л')
WHERE keyword LIKE '%?%';

<section> <p> С тази заявка всички „?“ бяха заменени с правилната буква „л“. Това е бързо решение, което пести часове ръчна работа. </p> <h3>Стъпки за репродуциране</h3> <ol> <li>Създайте OCMOD файл с горния код и го качете през админ панела.</li> <li>Рефрешнете модификациите и изчистете кеша.</li> <li>Стартирайте SQL заявката в phpMyAdmin, за да оправите вече счупените записи.</li> <li>Тествайте с нов продукт с име „масло“ – URL-ът вече ще е <code>/масло</code>, без да се чупи.</li> </ol> <h3>Резултат</h3> <p> След промяната сайтът вече не генерираше счупени линкове. SEO URL-ите на кирилица, включително тези с „л“, се показваха правилно. Потребителите виждаха чисти и работещи адреси, а Google започна да индексира съдържанието без 404 грешки. </p> <h4>Извод</h4> <p> Понякога дори една буква може да счупи цял сайт. В OpenCart 2.3.0.2 липсата на правилна обработка на UTF-8 доведе до масови 404 грешки. Решението беше комбинация от OCMOD за новите URL-и и SQL заявка за старите. Резултатът: стабилен магазин, доволни клиенти и SEO без загуби. </p> </section> ```
